{% extends '_base.html' %}

{% block header_content %}
{% endblock %}


{% block content %}
<h1>{{ COPY.content.project_name }}</h1>

<div id="story-meta">
    <p class="byline">by <span>{{ COPY.content.byline }}</span></p>
    <p class="dateblock">
        <span class="date">{{ COPY.content.pubdate }}</span>
        <span class="time"> {{ COPY.content.pubtime }}</span>
    </p>
</div>

<a class="comment-button comment-button-bubble comment-drawer-toggle" href="javascript:">
    <span class="comment-count"></span>
</a>

<a class="comment-button comment-button-article comment-drawer-toggle" data-toggle="modal" data-backdrop="static" data-target="#share-modal">
    <span class="comment-count"></span>
    <span class="comment-label">Share / Discuss</span>
</a>

<a id="chromecast">Chromecast me!</a>

{% endblock %}

{% block extra_foot %}
<script type="text/javascript" src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js"></script>

<script type="text/javascript">
    var DATA = {{ data|safe }};
    var session = null;

    window['__onGCastApiAvailable'] = function(loaded, errorInfo) {
        if (loaded) {
            initializeCastApi();
        } else {
            console.log(errorInfo);
        }
    }

    initializeCastApi = function() {
        var sessionRequest = new chrome.cast.SessionRequest('A6BCDD1E');
        var apiConfig = new chrome.cast.ApiConfig(
            sessionRequest,
            sessionListener,
            receiverListener
        );

        chrome.cast.initialize(apiConfig, onInitSuccess, onError);
    };

    function sessionListener(e) {
        session = e;
    }

    function receiverListener(e) {
        if (e === chrome.cast.ReceiverAvailability.AVAILABLE) {
            console.log('available');
        } else {
            console.log('not available');
        }
    }

    $('#cast').click(function(e) {
        e.preventDefault();

        chrome.cast.requestSession(onRequestSessionSuccess, onLaunchError);
    }

    function onRequestSessionSuccess(e) {
        session = e;
    }
</script>
{% endblock %}

{% include '_share_modal.html' %}
