{% extends '_base_results.html' %}

{% block extra_css %}
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>

{{ CSS.push('less/results.less') }}
{{ CSS.render('css/results.min.css') }}
{% endblock extra_css %}

{% block body_class %}{{ page_class }}{% endblock body_class %}


{% block outer_content %}
<div class="container">

    <div class="results-header">
        <h1>{{ page_title }}</h1>
        <div class="leaderboard">
            <div class="results-header-group dem">
                <h2 class="party">Dem</h2>
                <p class="total"><span class="percentage">{{ bop.dem.has }}</span> <span class="change">{{ bop.dem.picked_up|signed }}</span></p>
                <p class="seats-needed" colspan="2">Needs <span class="count">{{ bop.dem.needs }}</span></p>
            </div>
            <div class="results-header-group gop">
                <h2 class="party">GOP</h2>
                <p class="total"><span class="percentage">{{ bop.gop.has }}</span> <span class="change">{{ bop.gop.picked_up|signed }}</span></p>
                <p class="seats-needed" colspan="2">Needs <span class="count">{{ bop.gop.needs }}</span></td>
                </tr>
            </div>
            <div class="results-header-group other">
                <h2 class="party">Other</h2>
                <p class="total"><span class="percentage">{{ bop.other.has }}</span> <span class="change">{{ bop.other.picked_up|signed }}</span></p>
            </div>
            <div class="results-header-group not-called">
                <h2>Not Called</h2>
                <p class="total"><span class="count">0</span></p>
            </div>
        </div>
    </div>

    <div class="results">
        {% for closing_time, races in poll_groups %}
        <h2 class="poll-closing-group"><span class="time"><span class="time-inner">{{ closing_time|format_board_time }}</span></span></h2>
        <table class="races">
            {% for race in races %}
            <tr class="race dontsplit">
                <td class="results-status{% if race.is_called() %} called{% elif race.is_reporting() %} reporting{% endif %}">
                    {% if race.is_called() %}
                        {{ race.get_called_time()|format_board_time }}
                    {% elif race.is_reporting() %}
                        {{ race.precincts_reporting_percent()|format_percent }}% 
                    {% else %}
                        0%
                    {% endif %}
                </td>
                <td class="state{% if race.is_called() and race.party_changed() %} party-change {{ race.get_winning_party() }}{% endif %}">{{ race.state_postal }}</td>
                {% set candidate = race.top_candidates()[0] %}
                {% if candidate %}
                <td class="candidate {{ candidate.party|lower }} id-{{ candidate.candidate_id }}{% if candidate.is_winner() %} winner{% endif %}{% if candidate.incumbent %} incumbent{% endif %}"><span class="fname">{{ candidate.first_name }}</span> <span class="lname">{{ candidate.last_name }}</span></td>
                <td class="candidate-total {{ candidate.party|lower }}{% if candidate.is_winner() %} winner{% endif %}">{% if race.is_reporting() %}{{ candidate.vote_percent()|format_percent }}<span class="percent">%</span>{% else %}--{% endif %}</td>
                {% else %}
                <td class="candidate"></td>
                <td class="candidate-total"></td>
                {% endif %}
                {% set candidate = race.top_candidates()[1] %}
                {% if candidate %}
                <td class="candidate-total {{ candidate.party|lower }}{% if candidate.is_winner() %} winner{% endif %}{% if candidate.incumbent %} incumbent{% endif %}">{% if race.is_reporting() %}{{ candidate.vote_percent()|format_percent }}<span class="percent">%</span>{% else %}--{% endif %}</td>
                <td class="candidate {{ candidate.party|lower }} id-{{ candidate.candidate_id }}{% if candidate.is_winner() %} winner{% endif %}"><span class="fname">{{ candidate.first_name }}</span> <span class="lname">{{ candidate.last_name }}</span></td>
                {% else %}
                <td class="candidate-total"></td>
                <td class="candidate"></td>
                {% endif %}
            </tr>
            {% endfor %}
        </table>
        {% endfor %}
    </div>

    <div class="key">
        <ul>
            <li>Results are ordered by poll closing time</li>
            <li><span class="bold">Highlighted box with candidate</span> <span class="name-ex">Jane Smith</span> :    Projected winner</li>
        </ul>
        <ul>
            <li><span class="bold">Black box with time</span> <span class="time-ex bold">8:00</span> : When a winner was projected </li>
            <li><span class="bold">Yellow box with percentage</span> <span class="percent-ex bold">5%</span> : Precincts reporting </li>
        </ul>
        <ul>
            <li><span class="bold">Bold state</span> <span class="state-ex bold">VA</span> : Seat has switched to party of corresponding color</li>
            <li><span class="bold">Bold candidate</span> <span class="incum-ex bold">Jane Smith</span> : Incumbent</li>
        </ul>
    </div>
</div>
{% endblock outer_content %}

{% block extra_foot_js %}
{{ JS.push('js/lib/pym.js') }}
{{ JS.push('js/lib/jquery.columnizer.js') }}
{{ JS.push('js/results.js') }}
{{ JS.render('js/results-footer.min.js') }}
<script>
$('.results').columnize({ columns: {{ column_number }} });
</script>
{% endblock extra_foot_js %}
